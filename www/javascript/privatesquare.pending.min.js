function privatesquare_pending_init(){var a=privatesquare_deferred_list();if(a.length==0)privatesquare_set_status("There are no pending checkins to administriviate.");else{var d=function(g){var h=Array("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec");g.getFullYear();var c=g.getDate();return h[g.getMonth()]+" "+c},b="<optgroup>";for(var e in a){var f=a[e],i=new Date(f.created*1E3);b+='<option value="'+htmlspecialchars(f.id)+'">';b+=d(i)+' at "';b+=htmlspecialchars(f.venue);
b+='"</option>'}b+="</optgroup>";b+='<optgroup class="admin">';b+='<option value="__purge__">';b+=a.length>1?"Delete all pending checkins":"Just forget this checkin";b+="</option>";b+="</optgroup>";$("#checkins").html(b);d=$("#deferred");d.attr("data-count-pending",a.length);d.submit(privatesquare_pending_onselect);d.show();privatesquare_pending_show_map(a)}}
function privatesquare_pending_onselect(){_privatesquare_hide_map();var a=$("#deferred"),d=$("#checkins"),b=d.val();if(b=="__purge__"){b="Are you sure you want to delete all those pending checkins?";if(a.attr("data-count-pending")==1)b="Are you sure you want to delete this checkin?";if(confirm(b)){d.html("");a.hide();privatesquare_deferred_purge();privatesquare_set_status("Okay all your pending checkins have been deleted.")}}else{d=privatesquare_deferred_get_by_id(b);privatesquare_pending_fetch_venues(d);
a.hide()}return false}function privatesquare_pending_fetch_venues(a){$.ajax({url:_cfg.abs_root_url+"api/",data:{method:"foursquare.venues.search",latitude:a.latitude,longitude:a.longitude,query:a.venue},success:function(d){d.checkin=a;_privatesquare_pending_fetch_venues_onload(d)}});privatesquare_set_status("Looking for '"+htmlspecialchars(a.venue)+"'")}
function _privatesquare_pending_fetch_venues_onload(a){privatesquare_unset_status();if(a.stat!="ok")privatesquare_api_error(a);else{var d=a.venues.length;if(d){var b="";b+="<optgroup>";for(var e=0;e<d;e++){var f=a.venues[e];b+='<option value="'+f.id+'">'+f.name+"</option>"}b+="</optgroup>";d=$("#where");d.attr("data-crumb",a.crumb);d.attr("data-checkin-id",a.checkin.id);d.html(b);$("#what").attr("disabled","disabled");$("#broadcast").attr("disabled","disabled");_privatesquare_show_map(a.latitude,
a.longitude,'"'+a.checkin.venue+'"');$("#venues").show();a=$("#meh");a.click(privatesquare_pending_delete_checkin);a.show();$("#checkin").submit(_privatesquare_pending_onsubmit)}else privatesquare_set_status("Ack! foursquare can't find like '"+htmlspecialchars(checkin.venue)+"' around there...")}}
function _privatesquare_pending_onsubmit(){$("#venues").hide();_privatesquare_hide_map();var a=privatesquare_gather_args(),d=$("#where").attr("data-checkin-id"),b=privatesquare_deferred_get_by_id(d);a.created=b.created;privatesquare_checkin(a,function(e){e.checkin=b;_privatesquare_pending_checkin_onload(e)});privatesquare_set_status("Checking in...");return false}
function privatesquare_pending_delete_checkin(){var a=$("#where").attr("data-checkin-id");a=privatesquare_deferred_get_by_id(a);if(confirm("Are you sure you want to delete this pending checkin?")){$("#venues").hide();$("#meh").hide();_privatesquare_hide_map();privatesquare_deferred_remove(a.id);if(privatesquare_deferred_list().length==0)privatesquare_set_status("All your pending checkins have been encheckin-ified (or deleted).");else{privatesquare_set_status("Your checkin at '"+htmlspecialchars(a.venue)+
"' has deleted.");privatesquare_pending_init()}}}function _privatesquare_pending_checkin_onload(a){if(a.stat!="ok")privatesquare_api_error(a);else{privatesquare_deferred_remove(a.checkin.id);if(privatesquare_deferred_list().length==0)privatesquare_set_status("All your pending checkins have been encheckin-ified!");else{privatesquare_set_status("Your checkin at '"+htmlspecialchars(a.checkin.venue)+"' has been encheckin-ified!");privatesquare_pending_init()}}}
function privatesquare_pending_show_map(a){var d=[],b=null,e=null,f=null,i=null;for(var g in a){var h=a[g],c=parseFloat(h.latitude),j=parseFloat(h.longitude);h=c+","+j;b=b==undefined?c:Math.min(b,c);e=e==undefined?j:Math.min(e,j);f=f==undefined?c:Math.max(f,c);i=i==undefined?j:Math.max(i,j);c="<div";c+=' class="marker marker-header"';c+=' data-location="'+h+'">';c+='<span class="marker-history-text"></span>';c+="</div>";d.push(c)}g=$("#map-wrapper");c=document.createElement("div");c=$(c);c.attr("class",
"map");if(a.length==1){h=b+","+e;c.attr("data-location",h);c.attr("data-zoom",14)}else{a=[b,e,f,i].join(",");c.attr("data-extent",a)}c.attr("data-hash",false);c.attr("data-touch",true);c.attr("data-provider","toner");c.html(d.join(""));g.html(c);g.show();privatesquare_htmapl(c)};
