function privatesquare_pending_init(){var a=privatesquare_deferred_list();if(a.length==0){privatesquare_set_status("There are no pending checkins to administriviate.");privatesquare_hide_map();$("#pending-form").hide()}else{var c=function(g){var h=Array("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec");g.getFullYear();var b=g.getDate();return h[g.getMonth()]+" "+b},e="<optgroup>";for(var d in a){var f=a[d],i=new Date(f.created*1E3);e+='<option value="'+htmlspecialchars(f.id)+
'">';e+=c(i)+' at "';e+=htmlspecialchars(f.venue);e+='"</option>'}e+="</optgroup>";$("#checkins").html(e);c=$("#meh");c.show();c.click(privatesquare_pending_purge_checkins);c=$("#deferred");c.attr("data-count-pending",a.length);c.show();c.submit(privatesquare_pending_onselect);privatesquare_pending_show_map(a)}}
function privatesquare_pending_onselect(){privatesquare_hide_map();$("#deferred").hide();var a=$("#checkins").val();a=privatesquare_deferred_get_by_id(a);$("#whatnow").val()=="delete"?privatesquare_pending_delete_checkin(a):privatesquare_pending_fetch_venues(a);return false}
function privatesquare_pending_fetch_venues(a){var c={query:'"'+a.venue+'"'};if(a.latitude&&a.longitude){c.latitude=a.latitude;c.longitude=a.longitude}else c.near=a.near;privatesquare_api_call("foursquare.venues.search",c);privatesquare_set_status("Looking for '"+htmlspecialchars(a.venue)+"'")}
function _privatesquare_pending_fetch_venues_onload(a){privatesquare_unset_status();if(a.stat!="ok")privatesquare_api_error(a);else{var c=a.venues.length;if(c){var e="";e+="<optgroup>";for(var d=0;d<c;d++){var f=a.venues[d];e+='<option value="'+f.id+'">'+f.name+"</option>"}e+="</optgroup>";d=$("#where");d.attr("data-crumb",a.crumb);d.attr("data-checkin-id",a.checkin.id);d.html(e);$("#what").attr("disabled","disabled");$("#broadcast").attr("disabled","disabled");if(a.latitude&&a.longitude)privatesquare_show_map(a.latitude,
a.longitude,'"'+a.checkin.venue+'"');else{e=a.venues.length;c=[];var i=f=null,g=null,h=null;for(d=0;d<e;d++){var b=a.venues[d],j=b.name,k=b.location.lat;b=b.location.lng;f=f==null?k:Math.min(f,k);i=i==null?b:Math.min(i,b);g=g==null?k:Math.max(g,k);h=h==null?b:Math.max(h,b);c.push([k,b,j])}privatesquare_show_map_bbox([f,i,g,h],c)}$("#venues").show();d=$("#meh");d.click(function(){privatesquare_pending_delete_checkin(a.checkin)});d.show();$("#checkin").submit(_privatesquare_pending_onsubmit)}else{d=
"Ack! foursquare can't find anything like '"+htmlspecialchars(a.checkin.venue)+"' around those parts.";d+=" Also, privatesquare isn't smart enough to deal with this situation yet...";privatesquare_set_status(d)}}}
function _privatesquare_pending_onsubmit(){var a=$("#where"),c=$("#whatnow");a=a.attr("data-checkin-id");var e=privatesquare_deferred_get_by_id(a);if(c.val()=="delete"){confirm("Are you sure you want to delete this pending checkin?")&&privatesquare_pending_delete_checkin(e);return false}$("#venues").hide();$("#meh").hide();privatesquare_hide_map();c=privatesquare_gather_args();c.created=e.created;privatesquare_checkin(c,function(d){d.checkin=e;_privatesquare_pending_checkin_onload(d)});privatesquare_set_status("Checking in...");
return false}function privatesquare_pending_purge_checkins(){var a="Are you sure you want to delete all those pending checkins?",c=$("#deferred");if(c.attr("data-count-pending")==1)a="Are you sure you want to delete all this checkin?";if(!confirm(a))return false;c.hide();privatesquare_deferred_purge();privatesquare_set_status("Okay all your pending checkins have been deleted.");return false}
function privatesquare_pending_delete_checkin(a){if(confirm("Are you sure you want to delete this pending checkin?")){$("#venues").hide();$("#meh").hide();privatesquare_hide_map();privatesquare_deferred_remove(a.id);if(privatesquare_deferred_list().length==0)privatesquare_set_status("All your pending checkins have been encheckin-ified (or deleted).");else{privatesquare_set_status("Your checkin at '"+htmlspecialchars(a.venue)+"' has deleted.");privatesquare_pending_init()}}}
function _privatesquare_pending_checkin_onload(a){if(a.stat!="ok")privatesquare_api_error(a);else{privatesquare_deferred_remove(a.checkin.id);if(privatesquare_deferred_list().length==0)privatesquare_set_status("All your pending checkins have been encheckin-ified!");else{privatesquare_set_status("Your checkin at '"+htmlspecialchars(a.checkin.venue)+"' has been encheckin-ified!");privatesquare_pending_init()}}}
function privatesquare_pending_show_map(a){var c=[],e=null,d=null,f=null,i=null;for(var g in a){var h=a[g],b=parseFloat(h.latitude),j=parseFloat(h.longitude);if(b&&j){h=b+","+j;e=e==undefined?b:Math.min(e,b);d=d==undefined?j:Math.min(d,j);f=f==undefined?b:Math.max(f,b);i=i==undefined?j:Math.max(i,j);b="<div";b+=' class="marker marker-header"';b+=' data-location="'+h+'">';b+='<span class="marker-history-text"></span>';b+="</div>";c.push(b)}}if(c.length!=0){g=$("#map-wrapper");b=document.createElement("div");
b=$(b);b.attr("class","map");if(a.length==1){h=e+","+d;b.attr("data-location",h);b.attr("data-zoom",14)}else{a=[e,d,f,i].join(",");b.attr("data-extent",a)}b.attr("data-hash",false);b.attr("data-touch",true);b.attr("data-provider","toner");b.html(c.join(""));g.html(b);g.show();privatesquare_htmapl(b)}};
