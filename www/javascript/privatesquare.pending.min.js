function privatesquare_pending_init(){var a=privatesquare_deferred_list();if(a.length==0)privatesquare_set_status("There are no pending checkins to administriviate.");else{var c=function(f){var g=Array("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec");f.getFullYear();var h=f.getDate();return g[f.getMonth()]+" "+h},b="<optgroup>";for(var d in a){var e=a[d],i=new Date(e.created*1E3);b+='<option value="'+htmlspecialchars(e.id)+'">';b+=c(i)+' at "';b+=htmlspecialchars(e.venue);
b+='"</option>'}b+="</optgroup>";b+='<optgroup class="admin">';b+='<option value="__purge__">';b+=a.length>1?"Delete all pending checkins":"Just forget this checkin";b+="</option>";b+="</optgroup>";$("#checkins").html(b);c=$("#deferred");c.attr("data-count-pending",a.length);c.submit(privatesquare_pending_onselect);c.show();c="There are "+a.length+" pending checkins.";if(a.length==1)c="You have one pending checkin.";privatesquare_set_status(c)}}
function privatesquare_pending_onselect(){var a=$("#deferred"),c=$("#checkins"),b=c.val();if(b=="__purge__"){b="Are you sure you want to delete all those pending checkins?";if(a.attr("data-count-pending")==1)b="Are you sure you want to delete this checkin?";if(confirm(b)){c.html("");a.hide();privatesquare_deferred_purge();privatesquare_set_status("Okay all your pending checkins have been deleted.")}}else{c=privatesquare_deferred_get_by_id(b);privatesquare_pending_fetch_venues(c);a.hide()}return false}
function privatesquare_pending_fetch_venues(a){$.ajax({url:_cfg.abs_root_url+"api/",data:{method:"foursquare.venues.search",latitude:a.latitude,longitude:a.longitude,query:a.venue},success:function(c){c.checkin=a;_privatesquare_pending_fetch_venues_onload(c)}});privatesquare_set_status("Looking for '"+htmlspecialchars(a.venue)+"'")}
function _privatesquare_pending_fetch_venues_onload(a){privatesquare_unset_status();if(a.stat!="ok")privatesquare_api_error(a);else{var c=a.venues.length;if(c){var b="";b+="<optgroup>";for(var d=0;d<c;d++){var e=a.venues[d];b+='<option value="'+e.id+'">'+e.name+"</option>"}b+="</optgroup>";b+='<optgroup class="admin">';b+='<option value="-1">Meh, just delete this...</option>';b+="</optgroup>";c=$("#where");c.attr("data-crumb",a.crumb);c.attr("data-checkin-id",a.checkin.id);c.html(b);$("#what").attr("disabled",
"disabled");$("#broadcast").attr("disabled","disabled");_privatesquare_show_map(a.latitude,a.longitude,'"'+a.checkin.venue+'"');$("#venues").show();$("#checkin").submit(_privatesquare_pending_onsubmit)}else privatesquare_set_status("Ack! foursquare can't find like '"+htmlspecialchars(checkin.venue)+"' around there...")}}
function _privatesquare_pending_onsubmit(){$("#venues").hide();_privatesquare_hide_map();var a=privatesquare_gather_args(),c=$("#where").attr("data-checkin-id"),b=privatesquare_deferred_get_by_id(c);a.created=b.created;if(a.venue_id==-1){if(confirm("Are you sure you want to delete this pending checkin?")){privatesquare_deferred_remove(b.id);if(privatesquare_deferred_list().length==0)privatesquare_set_status("All your pending checkins have been encheckin-ified (or deleted).");else{privatesquare_set_status("Your checkin at '"+
htmlspecialchars(b.venue)+"' has deleted.");privatesquare_pending_init()}}return false}privatesquare_checkin(a,function(d){d.checkin=b;_privatesquare_pending_checkin_onload(d)});privatesquare_set_status("Checking in...");return false}
function _privatesquare_pending_checkin_onload(a){if(a.stat!="ok")privatesquare_api_error(a);else{privatesquare_deferred_remove(a.checkin.id);if(privatesquare_deferred_list().length==0)privatesquare_set_status("All your pending checkins have been encheckin-ified!");else{privatesquare_set_status("Your checkin at '"+htmlspecialchars(a.checkin.venue)+"' has been encheckin-ified!");privatesquare_pending_init()}}};
