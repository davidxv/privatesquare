function privatesquare_deferred_has_local_storage(){try{new Store("privatesquare");return 1}catch(a){return 0}}
function privatesquare_deferred_checkin(a,c,b){a&&c&&privatesquare_show_map(a,c);privatesquare_unset_status();if(b=="offline")b="I've lost the network";else if(b=="api error")b="foursquare is sad";if(privatesquare_deferred_has_local_storage()){privatesquare_set_status(htmlspecialchars(b)+" / would you like to write a postcard to the future?");b=$("#deferred_where");b.val("");if(a&&c){b.attr("data-latitude",a);b.attr("data-longitude",c)}else{a=$("#deferred_city");a.val("");a.show()}$("#deferred_checkin").submit(privatesquare_deferred_checkin_submit);
$("#deferred").show()}else privatesquare_set_status(htmlspecialchars(b)+" / your browser can't store deferred checkins / sad browser is sad")}function privatesquare_deferred_checkin_submit(){var a=parseInt((new Date).getTime()/1E3),c=$("#deferred_where"),b=c.val(),d=$("#deferred_city").val();a={id:b+"#"+a,venue:b,latitude:c.attr("data-latitude"),longitude:c.attr("data-longitude"),near:d,created:a};privatesquare_deferred_store(a,privatesquare_deferred_checkin_stored);return false}
function privatesquare_deferred_checkin_stored(a){privatesquare_set_status("Okay! Your checkin at '"+a.venue+"' has been recorded.");privatesquare_hide_map();$("#deferred_checkin").hide()}
function privatesquare_deferred_indicator(){var a=(new Store("privatesquare")).get("deferred");a=a?Object.keys(a).length:0;var c=$("#pending"),b=$("#pending_count");if(a==1){b.html('<a href="'+privatesquare_abs_root_url()+'me/pending/">(1) pending checkin</a>');c.show()}else if(a){b.html('<a href="'+privatesquare_abs_root_url()+'me/pending/">('+a+") pending checkins</a>");c.show()}else{b.html("");c.hide()}}
function privatesquare_deferred_list(a){a=a?a.toLowerCase():"asc";var c=(new Store("privatesquare")).get("deferred"),b=[];if(!c)return b;for(var d in c)b.push(c[d]);b.sort(function(e,f){if(e.created<f.created)return a=="desc"?1:-1;if(e.created>f.created)return a=="desc"?-1:1;return 0});return b}function privatesquare_deferred_store(a,c){var b=new Store("privatesquare"),d=b.get("deferred");d||(d={});d[a.id]=a;b.set("deferred",d);b=null;if(c)b=function(){c(a)};_privatesquare_deferred_onupdate(b)}
function privatesquare_deferred_get_by_id(a){var c=(new Store("privatesquare")).get("deferred");if(c)return c[a];return null}function privatesquare_deferred_remove(a,c){var b=new Store("privatesquare"),d=b.get("deferred");if(d){delete d[a];b.set("deferred",d)}_privatesquare_deferred_onupdate(c)}function privatesquare_deferred_purge(a){var c=new Store("privatesquare");c.get("deferred")&&c.remove("deferred");_privatesquare_deferred_onupdate(a)}
function _privatesquare_deferred_onupdate(a){privatesquare_deferred_indicator();a&&a()};
